/*! promitto.js - v0.1 - MIT License - https://github.com/h2non/promitto */
!function(r){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.promitto=r()}}(function(){var r,n,e;return function t(r,n,e){function u(o,a){if(!n[o]){if(!r[o]){var f=typeof require=="function"&&require;if(!a&&f)return f(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var c=n[o]={exports:{}};r[o][0].call(c.exports,function(n){var e=r[o][1][n];return u(e?e:n)},c,c.exports,t,r,n,e)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<e.length;o++)u(e[o]);return u}({1:[function(r,n,e){{var t=r("./utils");var u=t.isPromise;var i=r("./deferred");var o=i.deferred;var a=i.resolved}var f=function l(r){return function(){var n=0;return function(){n=n+1;return r-n===0}}.call(this)};var c=function s(r){return function(n,e){return r[n]=e}};var v=e.all=function d(r){return Array.isArray(r)?function(){var n=void 0;var e=[];var t=false;var i=o();var a=r.slice();var v=c(e);var l=f(a.length);a.forEach(function(r,o){return u(r)?function(){r.then(function(r){return!t?v(o,r):void 0},function(r){t=true;return n=r});return r.finally(function(){i.notify(o);return l()||t?t?i.reject(n):i.resolve(e):void 0})}():function(){l();return v(o,null)}()});return i.promise}.call(this):a()}},{"./deferred":2,"./utils":6}],2:[function(r,n,e){{var t=r("./utils");var u=t.isFn;var i=t.toArr;var o=t.isPromise;var a=t.nextTick;var f=t.chain;var c=r("./types");var v=c.states;var l=c.newState;var s=c.newPool;var d=c.newBuf;var p=r("./promise");var y=p.promise}var h=function O(r){return function(n,e){return u(e)?r[n].push(e):void 0}};var m=function S(r){return function(n){return!(n==="notify")&&r.pending?function(){r.pending=false;n==="resolve"?r.resolve=true:void 0;return n==="reject"?r.reject=true:void 0}():void 0}};var j=function C(r){return function(n,e){return r[n]=i(e)}};var w=function z(r,n){return function(e,t){return e==="finally"?r.reject?n.reject:n.resolve:n[e]}};var g=function D(r){return function(n){return r[n].splice(0)}};var x=function G(r,n,e){return function(){var t=g(n);var u=w(r,e);return function(r){n[r].forEach(function(n){return function(){var e=u(r,n);return n.apply(void 0,e)}.call(this)});return(r==="notify"?false:true)?t(r):void 0}}.call(this)};var E=function H(r,n,e){return function(){var t=x(r,n,e);return function(n){return a(function(){r[n]||n==="notify"?t(n):void 0;return!r.pending?t("finally"):void 0})}}.call(this)};var P=function I(r,n,e){return function(t,u){r(t,u);n(t);return e(t)}};var b=function J(r){return function(n){return function(){return r(n,arguments)}}};var A=function K(r,n){return function(){r("notify",arguments);return n("notify")}};var k=function L(r){Object.keys(r).forEach(function(n){return function(){var e=r[n];return(n==="promise"?false:true)?r[n]=f(r,e):void 0}.call(this)});return r};var q=e.deferred=function M(){return function(){var r=d();var n=s();var e=l();var t=h(n);var u=j(r);var i=m(e);var o=E(e,n,r);var a=P(u,i,o);var f=b(a);var c={resolve:f("resolve"),reject:f("reject"),notify:A(u,o),promise:y(e,t,o)};return k(c)}.call(this)};var T=e.resolved=function N(r){return function(){var n=q();n.resolve(r);return n.promise}.call(this)};var F=e.rejected=function Q(r){return function(){var n=q();n.reject(r);return n.promise}.call(this)};var B=e.when=function R(r,n){return o(r)?r:T(n)}},{"./promise":3,"./types":5,"./utils":6}],3:[function(r,n,e){{var t=r("./utils");var u=t.chain;var i=r("./types");var o=i.states}var a=function p(r,n){return function(e,t,u){var i=arguments;o.forEach(function(n,e){return r(n,i[e])});return o.forEach(n)}};var f=function y(r,n){return function(e){r("finally",e);return n("finally")}};var c=function h(r,n){return function(e){r("reject",e);return n("reject")}};var v=function m(r,n,e){return function(r){n("notify",r);return e("notify")}};var l=function j(r){return function n(e,t,u){r.then.apply(r,arguments);return r}};var s=function w(r){return function(){var n=l(r);Object.keys(r).forEach(function(e){return n[e]=u(n,r[e])});return n}.call(this)};var d=e.promise=function g(r,n,e){var t={then:a(n,e),"finally":f(n,e),"catch":c(n,e),notify:v(r,n,e)};return s(t)}},{"./types":5,"./utils":6}],4:[function(r,n,e){{var t=r("./utils");var u=t.isPromise;var i=t.isFn;var o=r("./collections");var a=o.all;var f=r("./deferred");var c=f.deferred;var v=f.resolved;var l=f.rejected;var s=f.when}var d=function p(r){return function(){var n=c();!i(r)?function(){throw new TypeError("first argument must be a function")}():void 0;(function(){try{return r(n.resolve,n.reject,n.notify)}catch(e){return n.reject(e)}})();return n.promise}.call(this)};d.Promise=d;d.defer=c;d.when=s;d.resolve=v;d.reject=l;d.all=a;d.isPromise=u;n.exports=d},{"./collections":1,"./deferred":2,"./utils":6}],5:[function(r,n,e){var t=e.newBuf=function a(){return{}};var u=e.states=["resolve","reject","notify"];var i=e.newState=function f(){return{pending:true,resolve:false,reject:false}};var o=e.newPool=function c(){return{reject:[],resolve:[],"finally":[],notify:[]}}},{}],6:[function(r,n,e){var t=e.isFn=function f(r){return typeof r==="function"};var u=e.toArr=function c(r){return Array.prototype.slice.call(r)};var i=e.isPromise=function v(r){return t(r)&&t(r.then)};var o=e.nextTick=function l(r){return setTimeout(r,0)};var a=e.chain=function s(r,n){return function(){n.apply(void 0,arguments);return r}}},{}]},{},[4])(4)});