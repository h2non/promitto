/*! promitto.js - v0.1 - MIT License - https://github.com/h2non/promitto */
!function(r){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.promitto=r()}}(function(){var r,n,e;return function t(r,n,e){function i(o,f){if(!n[o]){if(!r[o]){var a=typeof require=="function"&&require;if(!f&&a)return a(o,!0);if(u)return u(o,!0);throw new Error("Cannot find module '"+o+"'")}var c=n[o]={exports:{}};r[o][0].call(c.exports,function(n){var e=r[o][1][n];return i(e?e:n)},c,c.exports,t,r,n,e)}return n[o].exports}var u=typeof require=="function"&&require;for(var o=0;o<e.length;o++)i(e[o]);return i}({1:[function(r,n,e){{var t=r("./utils");var i=t.isPromise;var u=r("./deferred");var o=u.deferred;var f=u.resolved}var a=function l(r){return function(){var n=0;return function(){n=n+1;return r-n===0}}.call(this)};var c=function s(r){return function(n,e){return r[n]=e}};var v=e.all=function d(r){return Array.isArray(r)?function(){var n=void 0;var e=[];var t=false;var u=o();var f=r.slice();var v=c(e);var l=a(f.length);f.forEach(function(r,o){return i(r)?function(){r.then(function(r){return!t?v(o,r):void 0},function(r){t=true;return n=r});return r.finally(function(){u.notify(o);return l()||t?t?u.reject(n):u.resolve(e):void 0})}():function(){l();return v(o,null)}()});return u.promise}.call(this):f()}},{"./deferred":2,"./utils":6}],2:[function(r,n,e){{var t=r("./utils");var i=t.isFn;var u=t.toArr;var o=t.isPromise;var f=t.nextTick;var a=t.chain;var c=r("./types");var v=c.states;var l=c.newState;var s=c.newPool;var d=c.newBuf;var y=r("./promise");var p=y.promise}var h=function F(r){return function(n,e){return i(e)?r[n].push(e):void 0}};var m=function B(r){return function(n){return!(n==="notify")&&r.pending?function(){r.pending=false;n==="resolve"?r.resolve=true:void 0;return n==="reject"?r.reject=true:void 0}():void 0}};var j=function S(r){return function(n,e){return r[n]=u(e)}};var w=function C(r,n){return function(e,t){return e==="finally"?r.reject?n.reject:n.resolve:n[e]}};var g=function O(r,n){return function(){var e=w(r,n);return function(r){return function(n){return i(n)?function(){var t=e(r,n);return n.apply(void 0,t)}.call(this):void 0}}}.call(this)};var x=function z(r,n,e){return function(){var t=g(r,e);return function(e){return f(function(){r[e]||e==="notify"?function(){n[e].forEach(t(e));return!(e==="notify")?n[e].splice(0):void 0}():void 0;return!r.pending&&n["finally"].length?function(){r[e]||e==="notify"?function(){n[e].forEach(t(e));return!(e==="notify")?n[e].splice(0):void 0}():void 0;n.finally.forEach(t("finally"));return n.finally.splice(0)}():void 0})}}.call(this)};var E=function D(r,n,e){return function(t,i){r(t,i);n(t);return e(t)}};var P=function G(r){return function(n){return function(){return r(n,arguments)}}};var b=function H(r,n){return function(){r("notify",arguments);return n("notify")}};var A=e.deferred=function I(){return function(){var r=d();var n=s();var e=l();var t=h(n);var i=j(r);var u=m(e);var o=x(e,n,r);var f=E(i,u,o);var c=P(f);var v={resolve:a(v,c("resolve")),reject:a(v,c("reject")),notify:a(v,b(i,o)),promise:p(e,t,o)};return v}.call(this)};var q=e.resolved=function J(r){return function(){var n=A();n.resolve(r);return n.promise}.call(this)};var T=e.rejected=function K(r){return function(){var n=A();n.reject(r);return n.promise}.call(this)};var k=e.when=function L(r,n){return o(r)?r:q(n)}},{"./promise":3,"./types":5,"./utils":6}],3:[function(r,n,e){{var t=r("./utils");var i=t.chain;var u=r("./types");var o=u.states}var f=function y(r,n){return function(e,t,i){var u=arguments;o.forEach(function(n,e){return r(n,u[e])});return o.forEach(n)}};var a=function p(r,n){return function(e){r("finally",e);return n("finally")}};var c=function h(r,n){return function(e){r("reject",e);return n("reject")}};var v=function m(r,n,e){return function(r){n("notify",r);return e("notify")}};var l=function j(r){return function n(e,t,i){r.then.apply(r,arguments);return r}};var s=function w(r){return function(){var n=l(r);Object.keys(r).forEach(function(e){return n[e]=i(n,r[e])});return n}.call(this)};var d=e.promise=function g(r,n,e){var t={then:f(n,e),"finally":a(n,e),"catch":c(n,e),notify:v(r,n,e)};return s(t)}},{"./types":5,"./utils":6}],4:[function(r,n,e){{var t=r("./utils");var i=t.isPromise;var u=t.isFn;var o=r("./collections");var f=o.all;var a=r("./deferred");var c=a.deferred;var v=a.resolved;var l=a.rejected;var s=a.when}var d=function y(r){return function(){var n=c();!u(r)?function(){throw new TypeError("first argument must be a function")}():void 0;(function(){try{return r(n.resolve,n.reject,n.notify)}catch(e){return n.reject(e)}})();return n.promise}.call(this)};d.Promise=d;d.defer=c;d.when=s;d.resolve=v;d.reject=l;d.all=f;d.isPromise=i;n.exports=d},{"./collections":1,"./deferred":2,"./utils":6}],5:[function(r,n,e){var t=e.newBuf=function f(){return{}};var i=e.states=["resolve","reject","notify"];var u=e.newState=function a(){return{pending:true,resolve:false,reject:false}};var o=e.newPool=function c(){return{reject:[],resolve:[],"finally":[],notify:[]}}},{}],6:[function(r,n,e){var t=e.isFn=function a(r){return typeof r==="function"};var i=e.toArr=function c(r){return Array.prototype.slice.call(r)};var u=e.isPromise=function v(r){return t(r)&&t(r.then)};var o=e.nextTick=function l(r){return setTimeout(r,0)};var f=e.chain=function s(r,n){return function(){n.apply(void 0,arguments);return r}}},{}]},{},[4])(4)});